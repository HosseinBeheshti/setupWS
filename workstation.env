# ============================================================
# Secure Remote Access Gateway Configuration
# ============================================================
#
# This configuration file defines settings for a hybrid secure access solution:
# - L2TP/IPSec as VPN option for application-specific routing in VNC sessions
# - Cloudflare Zero Trust for secure SSH/VNC access management
# - Cloudflare WARP custom endpoint to bypass ISP filtering
#
# ARCHITECTURE:
#   - L2TP/IPsec: Application-specific VPN for routing VPN_APPS in VNC sessions
#   - Cloudflare Access: Identity-aware SSH/VNC access (no traffic routing)
#   - Cloudflare WARP: Custom endpoint through VPS tunnel (bypasses filtering)
#
# MAIN SCRIPTS:
#   sudo ./setup_ws.sh        - ONE-TIME VPS setup (installs L2TP, VNC, Cloudflare)
#   sudo ./run_vpn.sh         - Run L2TP VPN for VPN_APPS (use in VNC sessions)
#
# SETUP WORKFLOW:
#   1. Complete Cloudflare Zero Trust dashboard setup (Part 1 in README.md):
#      - Create Cloudflare Tunnel (cloudflared, NOT WARP Connector)
#      - Configure Identity Provider and Admin Policy
#      - Set up SSH/VNC Access Applications
#      - Copy tunnel token to CLOUDFLARE_TUNNEL_TOKEN below
#   
#   2. Edit this file (workstation.env):
#      - Add your CLOUDFLARE_TUNNEL_TOKEN
#      - Configure VNC users (usernames, passwords, ports)
#      - Set VPS IP address
#   
#   3. Run setup script:
#      sudo ./setup_ws.sh
#      (Installs all apps, sets up Cloudflare Access)
#   
#   4. Client setup:
#      - For SSH/VNC: Install Cloudflare One Agent for secure access
#
# USER ACCESS:
#   - VNC Session VPN: L2TP/IPsec (for routing specific apps in VNC) - run ./run_vpn.sh
#   - SSH/VNC Access: Cloudflare Access with Gmail + One-time PIN
#
# CONFIGURATION REQUIRED BELOW:
#   1. CLOUDFLARE_TUNNEL_TOKEN (from tunnel creation in dashboard)
#   2. VPS IP address
#   3. VNC user passwords (VNCUSER*_PASSWORD)
#   4. L2TP/IPsec credentials (for VPN_APPS routing in VNC sessions)
#
# ============================================================

# ============================================================
# --- VPS CONFIGURATION ---
# ============================================================
# VPS public IP address
VPS_PUBLIC_IP="<vps_public_ip>"


# ============================================================
# Installing required applications on the VPS 
# (without configuring them)
# ============================================================
# Note: This is a consolidated list of all packages needed by all setup scripts
APPS_TO_INSTALL="vim htop curl wget net-tools"

# ============================================================
# --- CLOUDFLARE TUNNEL CONFIGURATION (for SSH/VNC Access) ---
# ============================================================
# Cloudflare Tunnel token from Cloudflare dashboard
# Get this from: Networks → Tunnels → Create tunnel → cloudflared (NOT WARP Connector)
# After creating the tunnel, copy the token from the installation command

CLOUDFLARE_TUNNEL_TOKEN="<cloudflare_tunnel_token>"

# Tunnel name (must match the name you created in Cloudflare dashboard)
TUNNEL_NAME="vps-access"


# ============================================================
# --- VNC USERS CONFIGURATION ---
# ============================================================
# Configure VNC server users for remote desktop access
# Each user gets their own VNC server instance on a dedicated port

# User 1
VNCUSER1_USERNAME='<user_name>'
VNCUSER1_PASSWORD='<strong_password>'
VNCUSER1_DISPLAY='1'
VNCUSER1_RESOLUTION='1920x1080'
VNCUSER1_PORT='<vnc_port_1>'

# User 2
VNCUSER2_USERNAME='<user_name>'
VNCUSER2_PASSWORD='<strong_password>'
VNCUSER2_DISPLAY='2'
VNCUSER2_RESOLUTION='1920x1080'
VNCUSER2_PORT='<vnc_port_2>'

# User 3
VNCUSER3_USERNAME='<user_name>'
VNCUSER3_PASSWORD='<strong_password>'
VNCUSER3_DISPLAY='3'
VNCUSER3_RESOLUTION='1920x1080'
VNCUSER3_PORT='<vnc_port_3>'

# Add more users as needed (VNCUSER3_*, VNCUSER4_*, etc.)
# Total number of VNC users configured
VNC_USER_COUNT=3

# ============================================================
# --- L2TP/IPSEC VPN CONFIGURATION (for VPN_APPS in VNC) ---
# ============================================================
# L2TP is used to route specific applications through a remote VPN
# Run 'sudo ./run_vpn.sh' in your VNC session to activate L2TP
# Note: L2TP is only for app-specific routing in VNC sessions

# --- L2TP VPN Configuration ---
L2TP_SERVER_IP='<l2tp_server_ip>'
L2TP_IPSEC_PSK='<ipsec_preshared_key>'
L2TP_USERNAME='<user_name>'
L2TP_PASSWORD='<strong_password>'
L2TP_PPP_GATEWAY='192.168.150.1'
# Remote PC IP to route through L2TP VPN (optional, leave empty if not needed)
L2TP_REMOTE_PC_IP='<remote_pc_ip>'

# --- VPN Applications Configuration ---
# Applications to route through L2TP VPN when running ./run_vpn.sh
# These apps will have their traffic routed through L2TP when VPN is active in VNC session
# Note: L2TP is only for app-specific routing in VNC sessions
VPN_APPS="xrdp remmina"

# --- Virtual Router Configuration ---
# Starting routing table number (will auto-increment for each VPN)
VR_TABLE_START=200

# ============================================================
# --- XRAY VPN CONFIGURATION (VLESS + Reality) ---
# ============================================================
# Xray-core proxy server with VLESS + Reality protocol
# Reality protocol mimics legitimate HTTPS traffic to bypass DPI filtering
# No SSL certificates needed - uses Reality's SNI spoofing instead

# Xray listening port (port where users connect to your VPS)
# Changed from 443 to 2053 to avoid conflicts or for custom routing
XRAY_LISTENING_PORT="2053"

# Xray port (for backward compatibility, same as XRAY_LISTENING_PORT)
XRAY_PORT="2053"

# VLESS UUID (unique identifier for authentication)
# Auto-generated during setup if left as default
# Generate manually: cat /proc/sys/kernel/random/uuid
XRAY_UUID="<auto_generated_uuid>"

# Network protocol (tcp is required for Reality)
XRAY_NETWORK="tcp"

# Security protocol (must be "reality" for Reality protocol)
XRAY_SECURITY="reality"

# Flow control mode (xtls-rprx-vision is required for Reality)
XRAY_FLOW="xtls-rprx-vision"

# Reality Protocol Settings
# Private key for Reality (auto-generated during setup)
# Generate manually: xray x25519
XRAY_REALITY_PRIVATE_KEY="<auto_generated_private_key>"

# Public key for Reality (auto-generated during setup)
# Derived from private key: echo "PRIVATE_KEY" | xray x25519 -i key
XRAY_REALITY_PUBLIC_KEY="<auto_generated_public_key>"

# Destination server for Reality (mimics connection to this site)
# Recommended: www.google.com, www.cloudflare.com, www.apple.com
# NOTE: Keep this at 443 to properly mimic HTTPS traffic
XRAY_REALITY_DEST="www.google.com:443"

# Server names for Reality (SNI values that will be accepted)
XRAY_REALITY_SERVER_NAMES="www.google.com,google.com"

# Short IDs for Reality (comma-separated hex strings, max 16 chars each)
# Example: "1a2b3c4d5e6f,a1b2c3d4e5f6"
# Leave empty to auto-generate or use specific IDs
XRAY_REALITY_SHORT_IDS=""

# ============================================================
# --- FIREWALL CONFIGURATION ---
# ============================================================
# Ports to allow through the firewall
# Leave empty for Cloudflare tunnel-only access (most secure)
# Format: comma-separated list of ports with protocol (e.g., "80/tcp,443/tcp,8080")
# Or just port numbers for both tcp/udp (e.g., "22,80,443")
# Example: FIREWALL_ALLOWED_PORTS="80/tcp,443/tcp,22/tcp"
# L2TP VPN ports: 500/udp (IPsec), 1701/udp (L2TP), 4500/udp (IPsec NAT-T)
# OpenConnect VPN: 443/tcp and 443/udp (configured via OCSERV_PORT)
# Xray Reality: 2053/tcp (VLESS listening port)
FIREWALL_ALLOWED_PORTS="500/udp,1701/udp,4500/udp,443,2053/tcp"

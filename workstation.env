# ============================================================
# Cloudflare Zero Trust ZTNA Configuration
# ============================================================
#
# This configuration file defines settings for a complete Zero Trust
# Network Access (ZTNA) deployment with dual-tier access control:
#
# ARCHITECTURE:
#   - Admin Tier: SSH & VNC access via Cloudflare Tunnel + Gateway posture checks
#   - User Tier: WireGuard VPN for secure internet routing through VPS
#
# MAIN SCRIPTS:
#   sudo ./setup_server.sh          - Initial VPS setup (Docker, Cloudflare, WireGuard, VNC)
#   sudo ./add_wg_peer.sh <user>    - Provision new WireGuard user
#   sudo ./query_users.sh           - Manage and view WireGuard users
#   sudo ./backup_ztna.sh           - Manual backup (auto runs daily at 2 AM)
#   sudo ./run_vpn.sh               - Admin VPN routing tool (L2TP/OpenVPN for your traffic)
#
# ADMIN ACCESS (via Cloudflare Zero Trust):
#   - Requires WARP client enrolled with Gateway
#   - TOTP 2FA authentication required
#   - Access: ssh.yourdomain.com, vnc-<user>.yourdomain.com
#
# USER ACCESS (via WireGuard):
#   - No authentication required (pre-shared keys)
#   - Route all internet traffic through VPS
#   - Add users with add_wg_peer.sh script
#
# CONFIGURATION REQUIRED BELOW:
#   1. CLOUDFLARE_TUNNEL_TOKEN (from Cloudflare dashboard)
#   2. CLOUDFLARE_DOMAIN (your domain)
#   3. WG_SERVER_PUBLIC_IP (your VPS IP)
#   4. VNC user passwords (VNCUSER*_PASSWORD)
#   5. Optional: L2TP/OpenVPN credentials for admin routing
#
# ============================================================

# ============================================================
# --- CLOUDFLARE ZERO TRUST CONFIGURATION ---
# ============================================================
# Required for Cloudflare Tunnel and Access
# Get these from: https://one.dash.cloudflare.com/

# Cloudflare Tunnel Token (from tunnel creation in CF dashboard)
CLOUDFLARE_TUNNEL_TOKEN=""

# Your domain managed by Cloudflare
CLOUDFLARE_DOMAIN="yourdomain.com"

# Cloudflare Zone ID (from domain overview page)
CLOUDFLARE_ZONE_ID=""

# ============================================================
# --- WIREGUARD VPN CONFIGURATION (User Access) ---
# ============================================================
# WireGuard VPN for routing user traffic through VPS

# VPS public IP address (auto-detected if left empty)
WG_SERVER_PUBLIC_IP=""

# WireGuard listen port (443/UDP recommended for Iran - appears as HTTPS/QUIC traffic)
# Other options: 53 (DNS), 123 (NTP), 40000-50000 (high range)
# Avoid: 51820 (default, blocked in Iran)
WG_PORT="443"

# WireGuard subnet for clients (sequential IP allocation)
WG_SUBNET="10.13.13.0/24"

# DNS servers for WireGuard clients
WG_DNS="1.1.1.1,1.0.0.1"

# ============================================================
# --- DATABASE & BACKUP CONFIGURATION ---
# ============================================================

# SQLite database path for user/device tracking
DB_PATH="/var/lib/ztna/users.db"

# Backup directory
BACKUP_DIR="/var/lib/ztna/backups"

# ============================================================
# --- VNC Users Configuration ---
# ============================================================

# User 1
VNCUSER1_USERNAME='gateway'
VNCUSER1_PASSWORD='change_this_strong_password'
VNCUSER1_DISPLAY='1'
VNCUSER1_RESOLUTION='1920x1080'
VNCUSER1_PORT='5910'

# User 2
VNCUSER2_USERNAME='vncuser'
VNCUSER2_PASSWORD='change_this_password_too'
VNCUSER2_DISPLAY='2'
VNCUSER2_RESOLUTION='1920x1080'
VNCUSER2_PORT='5911'

# Add more users as needed (VNCUSER3_*, VNCUSER4_*, etc.)
# Total number of VNC users configured
VNC_USER_COUNT=2

# --- Server Configuration ---
SERVER_PUBLIC_IP="YOUR_SERVER_PUBLIC_IP"

# --- VPN Configuration ---
# VPN types to configure (space-separated list: l2tp ovpn wireguard)
VPN_LIST="l2tp ovpn"

# --- L2TP VPN Configuration ---
L2TP_SERVER_IP='YOUR_VPN_SERVER_PUBLIC_IP'
L2TP_IPSEC_PSK='YOUR_IPSEC_PSK'
L2TP_USERNAME='vpn_username'
L2TP_PASSWORD='vpn_password'
L2TP_PPP_GATEWAY='192.168.150.1'
# Remote PC IP to route through L2TP VPN (optional, leave empty if not needed)
L2TP_REMOTE_PC_IP='YOUR_REMOTE_PC_IP'

# --- OpenVPN Configuration ---
OVPN_CONFIG_PATH='/etc/openvpn/client/config.ovpn'
OVPN_USERNAME='ovpn_user'
OVPN_PASSWORD='ovpn_password'

# --- VPN Applications Configuration ---
# Applications to route through selected VPN (space-separated)
# All apps listed here will have their traffic routed through the VPN you select at runtime
VPN_APPS="xrdp remmina firefox"

# --- Virtual Router Configuration ---
# Starting routing table number (will auto-increment for each VPN)
VR_TABLE_START=200

# --- Additional Applications to Install ---
# Space-separated list of applications to install
ADDITIONAL_APPS="vim htop curl wget net-tools docker vscode google-chrome-stable firefox"

# ============================================================
# Secure Remote Access Gateway Configuration
# ============================================================
#
# This configuration file defines settings for a hybrid secure access solution:
# - WireGuard VPN for all-traffic routing through your VPS
# - Cloudflare Zero Trust for secure SSH/VNC access management
# - L2TP/IPSec as fallback VPN option
#
# ARCHITECTURE:
#   - WireGuard VPN: Full tunnel for all client traffic (true VPN)
#   - Cloudflare Access: Identity-aware SSH/VNC access (no traffic routing)
#   - L2TP/IPSec: Fallback VPN for devices without WireGuard support
#
# MAIN SCRIPTS:
#   sudo ./setup_ws.sh        - ONE-TIME VPS setup (installs & configures everything)
#
# SETUP WORKFLOW:
#   1. Complete Cloudflare Zero Trust dashboard setup (Part 1 in README.md):
#      - Create Cloudflare Tunnel (cloudflared, NOT WARP Connector)
#      - Configure Identity Provider and Admin Policy
#      - Set up SSH/VNC Access Applications
#      - Copy tunnel token to CLOUDFLARE_TUNNEL_TOKEN below
#   
#   2. Edit this file (workstation.env):
#      - Add your CLOUDFLARE_TUNNEL_TOKEN
#      - Configure VNC users (usernames, passwords, ports)
#      - Configure WireGuard settings (ports, subnet, client count)
#      - Set VPS IP address
#   
#   3. Run setup script:
#      sudo ./setup_ws.sh
#      (Installs all apps, configures WireGuard, sets up Cloudflare Access)
#   
#   4. Client setup:
#      - For VPN: Install WireGuard client with generated config
#      - For SSH/VNC: Install Cloudflare One Agent for secure access
#
# USER ACCESS:
#   - VPN Traffic: WireGuard (all traffic exits via VPS IP)
#   - SSH/VNC Access: Cloudflare Access with Gmail + One-time PIN
#   - Fallback VPN: L2TP/IPSec for devices without WireGuard
#
# CONFIGURATION REQUIRED BELOW:
#   1. CLOUDFLARE_TUNNEL_TOKEN (from tunnel creation in dashboard)
#   2. VPS IP address
#   3. WireGuard settings (server port, subnet, client count)
#   4. VNC user passwords (VNCUSER*_PASSWORD)
#   5. Optional: L2TP/IPSec credentials for fallback VPN
#
# ============================================================

# ============================================================
# Installing required applications on the VPS 
# (without configuring them)
# ============================================================
# Note: This is a consolidated list of all packages needed by all setup scripts
APPS_TO_INSTALL="vim htop curl wget net-tools"

# ============================================================
# --- CLOUDFLARE TUNNEL CONFIGURATION (for SSH/VNC Access) ---
# ============================================================
# Cloudflare Tunnel token from Cloudflare dashboard
# Get this from: Networks → Tunnels → Create tunnel → cloudflared (NOT WARP Connector)
# After creating the tunnel, copy the token from the installation command

CLOUDFLARE_TUNNEL_TOKEN="<cloudflare_tunnel_token>"

# Tunnel name (must match the name you created in Cloudflare dashboard)
TUNNEL_NAME="vps-access"

# VPS public IP address
VPS_PUBLIC_IP="<vps_public_ip>"

# ============================================================
# --- WIREGUARD VPN CONFIGURATION ---
# ============================================================
# WireGuard Server Settings
WG_SERVER_PORT="51820"
WG_SERVER_ADDRESS="10.8.0.1/24"  # VPN subnet for WireGuard
WG_CLIENT_DNS="1.1.1.1, 1.0.0.1"  # DNS servers for clients
WG_CLIENT_COUNT=3  # Number of client configurations to generate

# Note: Server/client keypairs will be auto-generated during setup
# Client configurations will be saved to /etc/wireguard/clients/

# ============================================================
# --- VNC USERS CONFIGURATION ---
# ============================================================
# Configure VNC server users for remote desktop access
# Each user gets their own VNC server instance on a dedicated port

# User 1
VNCUSER1_USERNAME='<user_name>'
VNCUSER1_PASSWORD='<strong_password>'
VNCUSER1_DISPLAY='1'
VNCUSER1_RESOLUTION='1920x1080'
VNCUSER1_PORT='<vnc_port_1>'

# User 2
VNCUSER2_USERNAME='<user_name>'
VNCUSER2_PASSWORD='<strong_password>'
VNCUSER2_DISPLAY='2'
VNCUSER2_RESOLUTION='1920x1080'
VNCUSER2_PORT='<vnc_port_2>'

# User 3
VNCUSER3_USERNAME='<user_name>'
VNCUSER3_PASSWORD='<strong_password>'
VNCUSER3_DISPLAY='3'
VNCUSER3_RESOLUTION='1920x1080'
VNCUSER3_PORT='<vnc_port_3>'

# Add more users as needed (VNCUSER3_*, VNCUSER4_*, etc.)
# Total number of VNC users configured
VNC_USER_COUNT=3

# ============================================================
# --- L2TP/IPSEC VPN CONFIGURATION (Optional Fallback) ---
# ============================================================

# List of VPN types to configure (space-separated)
# Options: l2tp, wg (WireGuard is always configured if this script is used)
VPN_LIST="l2tp wg"

# --- L2TP VPN Configuration ---
L2TP_SERVER_IP='<l2tp_server_ip>'
L2TP_IPSEC_PSK='<ipsec_preshared_key>'
L2TP_USERNAME='<user_name>'
L2TP_PASSWORD='<strong_password>'
L2TP_PPP_GATEWAY='192.168.150.1'
# Remote PC IP to route through L2TP VPN (optional, leave empty if not needed)
L2TP_REMOTE_PC_IP='<remote_pc_ip>'

# --- VPN Applications Configuration ---
# Applications to route through selected VPN (space-separated)
# All apps listed here will have their traffic routed through the VPN you select at runtime
VPN_APPS="xrdp remmina"

# --- Virtual Router Configuration ---
# Starting routing table number (will auto-increment for each VPN)
VR_TABLE_START=200